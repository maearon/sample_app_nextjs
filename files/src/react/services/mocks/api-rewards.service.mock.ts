import {rest} from 'msw';
import {environment} from 'src/environments/environment';
import {
  createDetailHandler,
  createFixResponseHandler,
  createMockData,
  createPaginationHandler,
} from 'src/react/lib/mock-helper';
import {ICampaignEnum} from 'src/shared/interfaces/reward.interface';

const campaignEnum: ICampaignEnum = {
  criteria: {
    fuel_total: 'Petrol purchase amount',
    fuel_count: 'No. of petrol purchases',
    store_order_total: 'In-store purchase amount',
    store_order_count: 'No. of in-store purchases',
    concierge_order_total: 'Deliver2me purchase amount',
    concierge_order_count: 'No. of deliver2me purchases',
    topup_total: 'Top-up amount',
    topup_count: 'No. of top-up',
    max_reward_amount: 'Max Reward Amount',
    max_reward_total: 'Max Reward Total',
    remaining_time: 'Remaining Time (days)',
    friend: 'No. of friends purchased petrol',
    create_wallet: 'Register Wallet PIN',
    set_loyalty_card: 'Set Loyalty Card',
    set_auto_topup: 'Set Auto top-up',
    activate_point_redemption: 'Activate point redemption',
    earn_points_count: 'Earn points count',
    earn_points_total: 'Earn points amount',
    quota: 'Limit to first X customer',
    hybrid: 'Multiple Criteria Type(Fuel, Topup, etc)',
    none: 'None Criteria - Grant rewards without criteria',
  },
  operator: {
    gte: 'Great or equal',
    lte: 'Less or equal',
    equal: 'Equal',
  },
  consequence: {
    cashback: 'Cashback',
    loyaltyPoints: 'Loyalty points',
    loyaltyPointsPercent: 'Loyalty points percent',
    percent: 'Percent',
    campaign: 'Campaign',
    none: 'None',
  },
};

const CAMPAIGNS = createMockData(
  [
    {
      stats: {assigned: 0},
      isActive: false,
      restriction: [],
      endDate: '+275760-09-13T00:00:00.000Z',
      disqualifyVoucherBatches: [],
      codes: [],
      includeList: [],
      excludeList: [],
      id: '60c976ab82c0400012774480',
      _id: '60c976ab82c0400012774480',
      name: 'Pravin test campaign',
      description: 'Pravin test campaign - HybridTestW001',
      startDate: '2021-06-16T03:56:29.415Z',
      category: 'achievement',
      maxMembersCap: 0,
      goals: [
        {
          groupGoal: null,
          multiReward: false,
          isActive: true,
          isSequenceGoal: null,
          criteria: [
            {
              transactionTypes: [
                'multi_fuel_total',
                'multi_topup_total',
                'multi_store_order_total',
                'multi_concierge_order_total',
              ],
              target: 5,
              current: 0,
              operator: 'gte',
              _id: '60c976ab82c0400012774482',
              type: 'hybrid',
              description: 'HybridTestW001',
              id: '60c976ab82c0400012774482',
              descriptionLocalized: null,
            },
          ],
          _id: '60c976ab82c0400012774481',
          id: '60c976ab82c040001277447f',
          name: 'HybridTestW001',
          description: 'HybridTestW001',
          consequence: [
            {
              index: 0,
              type: 'cashback',
              campaignId: null,
              value: 5,
              from: null,
              expiry: null,
            },
          ],
          campaignCategory: 'achievement',
          index: 0,
          createdAt: '2021-06-16T03:57:31.178Z',
          updatedAt: '2021-06-16T03:57:31.178Z',
        },
      ],
      createdAt: '2021-06-16T03:57:31.178Z',
      updatedAt: '2021-06-16T03:57:31.178Z',
    },
    {
      stats: {assigned: 1},
      isActive: true,
      restriction: ['hidden'],
      endDate: '2021-06-24T03:35:55.000Z',
      disqualifyVoucherBatches: [],
      id: '60c6cf1aef4dbe0012bb77b1',
      _id: '60c6cf1aef4dbe0012bb77b1',
      codes: [],
      includeList: [],
      excludeList: [],
      name: 'MonTest001',
      description: 'MonTest001',
      startDate: '2021-06-14T03:34:39.686Z',
      category: 'achievement',
      maxMembersCap: 0,
      goals: [
        {
          groupGoal: null,
          multiReward: false,
          isActive: true,
          isSequenceGoal: false,
          criteria: [
            {
              transactionTypes: [
                'multi_fuel_total',
                'multi_topup_total',
                'multi_store_order_total',
                'multi_concierge_order_total',
              ],
              target: 10,
              current: 0,
              operator: 'gte',
              _id: '60c975ff82c0400012774461',
              type: 'hybrid',
              description: 'Test',
              id: '60c975ff82c0400012774461',
              descriptionLocalized: null,
            },
          ],
          _id: '60c975ff82c0400012774460',
          id: '60c6cf1aef4dbe0012bb77b0',
          name: 'MonTest001',
          description: null,
          consequence: [
            {
              index: 0,
              type: 'cashback',
              campaignId: null,
              value: 5,
              from: null,
              expiry: null,
            },
          ],
          campaignCategory: 'achievement',
          index: 0,
          updatedAt: '2021-06-16T03:54:39.397Z',
          createdAt: '2021-06-16T03:54:39.397Z',
        },
      ],
      createdAt: '2021-06-14T03:38:02.334Z',
      updatedAt: '2021-06-16T03:54:39.397Z',
    },
    {
      id: '5d89ddc51c9d44000075a429',
      _id: '5d89ddc51c9d44000075a429',
      isActive: true,
      name: 'DISCO 2.0',
      description: 'Disco 2.0 PS TTDI additional code',
      restriction: ['hidden', 'brazeCustomer'],
      goals: [
        {
          groupGoal: null,
          multiReward: null,
          isActive: true,
          _id: '5dbbe49467c0dd0012e74b38',
          id: '5d567568d83e56603cdisco1',
          name: 'New User Referral Bonus (Disco 2.0)',
          description: 'Top-up RM30 and get rewarded with RM5',
          criteria: [
            {
              target: 30,
              current: 0,
              operator: 'gte',
              _id: '5dbbe49467c0dd0012e74b39',
              type: 'topup_total',
              description: 'desc',
            },
          ],
          consequence: {_id: '5dbbe49467c0dd0012e74b3a', type: 'cashback', value: 5, from: null},
          updatedAt: '2021-01-13T14:55:42.038Z',
          createdAt: '2019-11-01T07:53:56.488Z',
          campaignCategory: 'achievement',
        },
      ],
      startDate: '2019-09-23T16:00:01.602Z',
      createdAt: '2019-09-23T13:25:16.603Z',
      updatedAt: '2021-01-13T14:55:42.039Z',
      endDate: '2019-10-23T15:59:59.602Z',
      category: 'achievement',
      disqualifyVoucherBatches: [],
      stats: {assigned: 0},
      codes: [
        {
          _id: '5dbbda8f67c0dd0012e74a0d',
          code: 'c-test',
          campaign: '5d89ddc51c9d44000075a429',
          __v: 0,
          createdAt: '2019-11-01T07:11:11.034Z',
          updatedAt: '2019-11-01T07:11:11.034Z',
        },
        {
          _id: '5dbbda8f67c0dd0012e74a0e',
          code: 'c-test2',
          campaign: '5d89ddc51c9d44000075a429',
          __v: 0,
          createdAt: '2019-11-01T07:11:11.034Z',
          updatedAt: '2019-11-01T07:11:11.034Z',
        },
        {
          _id: '5dbbda8f67c0dd0012e74a0f',
          code: 'c-3333',
          campaign: '5d89ddc51c9d44000075a429',
          __v: 0,
          createdAt: '2019-11-01T07:11:11.034Z',
          updatedAt: '2019-11-01T07:12:50.657Z',
          merchantId: 'merchant1',
        },
        {
          _id: '5dbbe49467c0dd0012e74b33',
          code: 'c-wrwerwe',
          campaign: '5d89ddc51c9d44000075a429',
          __v: 0,
          createdAt: '2019-11-01T07:53:56.465Z',
          updatedAt: '2019-11-20T15:26:36.778Z',
          merchantId: '5dd5583d45144f00123b54ad',
        },
        {
          _id: '5dbbe49467c0dd0012e74b34',
          code: 'c-fewr',
          campaign: '5d89ddc51c9d44000075a429',
          __v: 0,
          createdAt: '2019-11-01T07:53:56.466Z',
          updatedAt: '2019-11-01T07:53:56.466Z',
        },
        {
          _id: '5dbbe49467c0dd0012e74b35',
          code: 'c-werwerwer',
          campaign: '5d89ddc51c9d44000075a429',
          __v: 0,
          createdAt: '2019-11-01T07:53:56.466Z',
          updatedAt: '2019-11-01T07:53:56.466Z',
        },
        {
          _id: '5dbbe49467c0dd0012e74b36',
          code: 'c-sdfdsffdfs',
          campaign: '5d89ddc51c9d44000075a429',
          __v: 0,
          createdAt: '2019-11-01T07:53:56.466Z',
          updatedAt: '2019-11-01T07:57:14.300Z',
          merchantId: 'merchant1',
        },
        {
          _id: '5dbbe49467c0dd0012e74b37',
          code: 'c-testrqweqweqw',
          campaign: '5d89ddc51c9d44000075a429',
          __v: 0,
          createdAt: '2019-11-01T07:53:56.466Z',
          updatedAt: '2019-11-01T07:53:56.466Z',
        },
      ],
    },
    {
      id: '60ab19a99fe2920010a685a9',
      _id: '60ab19a99fe2920010a685a9',
      stats: {assigned: 625},
      isActive: true,
      restriction: ['hidden', 'brazeCustomer'],
      endDate: '2022-05-24T03:11:54.000Z',
      disqualifyVoucherBatches: [],
      name: 'PFC Campaign',
      description:
        'Be a Mesra Elite member by fuelling a minimum of RM150 PETRONAS Primax 97 with Pro-Race in a month and unlock badge to the world of privileges and rewards.',
      startDate: '2021-05-24T02:35:25.992Z',
      category: 'achievement',
      maxMembersCap: 0,
      includeList: [],
      excludeList: [],
      goals: [
        {
          groupGoal: null,
          multiReward: false,
          isActive: true,
          isSequenceGoal: false,
          _id: '60ac9b5bccfc650010ef6302',
          id: '60ab19a99fe2920010a685a8',
          name: 'PFC ',
          description: null,
          criteria: [
            {
              transactionTypes: null,
              target: 150,
              current: 0,
              operator: 'gte',
              _id: '60ac9b5bccfc650010ef6303',
              type: 'fuel_total',
              description: 'PETRONAS Primax 97 with Pro-race monthly usage/spend',
              dependency: {stations: null, singleTransaction: null, fuelType: ['fuel_primax_97']},
            },
          ],
          consequence: [
            {index: 0, type: 'none', campaignId: null, value: null, from: null, expiry: null},
          ],
          campaignCategory: 'achievement',
          index: 0,
          updatedAt: '2021-05-25T06:38:19.451Z',
          createdAt: '2021-05-25T06:38:19.451Z',
        },
      ],
      createdAt: '2021-05-24T03:12:41.833Z',
      updatedAt: '2021-06-22T09:40:22.674Z',
      __v: 0,
      codes: [
        {
          _id: '5dbbda8f67c0dd0012e74a0d',
          code: 'c-test',
          campaign: '5d89ddc51c9d44000075a429',
          __v: 0,
          createdAt: '2019-11-01T07:11:11.034Z',
          updatedAt: '2019-11-01T07:11:11.034Z',
        },
        {
          _id: '5dbbda8f67c0dd0012e74a0e',
          code: 'c-test-code',
          campaign: '5d89ddc51c9d44000075a429',
          __v: 0,
          createdAt: '2019-11-01T07:11:11.034Z',
          updatedAt: '2019-11-01T07:11:11.034Z',
        },
        {
          _id: '5dbbda8f67c0dd0012e74a0f',
          code: 'c-3333',
          campaign: '5d89ddc51c9d44000075a429',
          __v: 0,
          createdAt: '2019-11-01T07:11:11.034Z',
          updatedAt: '2019-11-01T07:12:50.657Z',
          merchantId: 'merchant1',
        },
        {
          _id: '5dbbe49467c0dd0012e74b33',
          code: 'c-wrwerwe',
          campaign: '5d89ddc51c9d44000075a429',
          __v: 0,
          createdAt: '2019-11-01T07:53:56.465Z',
          updatedAt: '2019-11-20T15:26:36.778Z',
          merchantId: '5dd5583d45144f00123b54ad',
        },
        {
          _id: '5dbbe49467c0dd0012e74b34',
          code: 'c-fewr',
          campaign: '5d89ddc51c9d44000075a429',
          __v: 0,
          createdAt: '2019-11-01T07:53:56.466Z',
          updatedAt: '2019-11-01T07:53:56.466Z',
        },
        {
          _id: '5dbbe49467c0dd0012e74b35',
          code: 'c-werwerwer',
          campaign: '5d89ddc51c9d44000075a429',
          __v: 0,
          createdAt: '2019-11-01T07:53:56.466Z',
          updatedAt: '2019-11-01T07:53:56.466Z',
        },
        {
          _id: '5dbbe49467c0dd0012e74b36',
          code: 'c-sdfdsffdfs',
          campaign: '5d89ddc51c9d44000075a429',
          __v: 0,
          createdAt: '2019-11-01T07:53:56.466Z',
          updatedAt: '2019-11-01T07:57:14.300Z',
          merchantId: 'merchant1',
        },
        {
          _id: '5dbbe49467c0dd0012e74b37',
          code: 'c-testrqweqweqw',
          campaign: '5d89ddc51c9d44000075a429',
          __v: 0,
          createdAt: '2019-11-01T07:53:56.466Z',
          updatedAt: '2019-11-01T07:53:56.466Z',
        },
      ],
    },
  ],
  50,
  (data, index) => ({
    name: `${data.name} - (Mock ${index})`,
    id: `${data.id}-${index}`,
    _id: `${data._id}-${index}`,
  }),
);

// actual GET /campaigns/:id returns _id, never id
// portal-ui jsonviewer errors when both id  & _id present
const CAMPAIGNS_FOR_DETAIL = CAMPAIGNS.filter(
  (campaign) => campaign._id === '60ab19a99fe2920010a685a9',
).map(({id, ...campaign}) => campaign);

const CAMPAIGN_CUSTOMERS = createMockData(
  [
    {
      _id: '60d2c9ce37ac760012b0de5d',
      createdBy: {type: 'goals', name: 'registration'},
      groupGoal: null,
      multiReward: false,
      isActive: true,
      isSequenceGoal: false,
      actions: [],
      status: 'active',
      description: null,
      criteria: [
        {
          transactionTypes: null,
          target: 150,
          current: 0,
          operator: 'gte',
          _id: '60ac9b5bccfc650010ef6303',
          progress: 0,
          type: 'fuel_total',
          description: 'PETRONAS Primax 97 with Pro-race monthly usage/spend',
          dependency: {
            stations: null,
            singleTransaction: null,
            fuelType: ['fuel_primax_97'],
          },
        },
      ],
      consequence: [
        {
          index: 0,
          type: 'none',
          campaignId: null,
          value: null,
          from: null,
          expiry: null,
        },
      ],
      campaignCategory: 'achievement',
      index: 0,
      updatedAt: '2021-06-23T05:42:38.084Z',
      createdAt: '2021-06-23T05:42:38.084Z',
      campaignIterationId: '60d2c9ce37ac760012b0de5e',
      member: {
        _id: '60d2c9cd37ac760012b0de06',
        codesHistory: [],
        recovered: false,
        referralStat: {
          registered: 0,
          purchased: 0,
          _id: '60d2c9cd37ac760012b0de05',
        },
        userId: 'a112730c-50e4-48f8-8066-ab350967df08',
        referrerCode: null,
        referralCode: 'u2j28',
        createdAt: '2021-06-23T05:42:37.649Z',
        updatedAt: '2021-06-23T05:42:37.649Z',
        __v: 0,
        user: {
          id: 'a112730c-50e4-48f8-8066-ab350967df08',
          username: '601666040797',
          fullName: 'Vehicle Brand',
          email: 'vehiclebrand@email.com',
          emailVerified: false,
          createdAt: 1624426954560,
          enabled: true,
          profile: {
            internal: false,
            emailVerified: false,
            tags: [],
            userId: 'a112730c-50e4-48f8-8066-ab350967df08',
            createdAt: '2021-06-23T05:42:34.560Z',
            email: 'vehiclebrand@email.com',
            fullName: 'Vehicle Brand',
            phone: '601666040797',
            updatedAt: '2021-06-23T05:43:38.161Z',
            language: 'en',
            referrerCode: '',
            registrationCompleted: true,
            id: '60d2c9cae1788f00111bdca1',
          },
        },
      },
      title: 'PFC ',
      campaign: '60ab19a99fe2920010a685a9',
      campaignGoalId: '60ab19a99fe2920010a685a8',
      __v: 0,
    },
    {
      _id: '60d2a74437ac760012b0dd1d',
      createdBy: {type: 'goals', name: 'registration'},
      groupGoal: null,
      multiReward: false,
      isActive: true,
      isSequenceGoal: false,
      actions: [],
      status: 'active',
      description: null,
      criteria: [
        {
          transactionTypes: null,
          target: 150,
          current: 0,
          operator: 'gte',
          _id: '60ac9b5bccfc650010ef6303',
          progress: 0,
          type: 'fuel_total',
          description: 'PETRONAS Primax 97 with Pro-race monthly usage/spend',
          dependency: {
            stations: null,
            singleTransaction: null,
            fuelType: ['fuel_primax_97'],
          },
        },
      ],
      consequence: [
        {
          index: 0,
          type: 'none',
          campaignId: null,
          value: null,
          from: null,
          expiry: null,
        },
      ],
      campaignCategory: 'achievement',
      index: 0,
      updatedAt: '2021-06-23T03:15:16.681Z',
      createdAt: '2021-06-23T03:15:16.681Z',
      campaignIterationId: '60d2a74437ac760012b0dd1e',
      member: {
        _id: '60d2a74437ac760012b0dcc6',
        codesHistory: [],
        recovered: false,
        referralStat: {
          registered: 0,
          purchased: 0,
          _id: '60d2a74437ac760012b0dcc5',
        },
        userId: '5a75dbe6-5b90-42c5-af44-302d5423bba8',
        voucherBatchId: '60d2a5e11044ff001161f01a',
        referrerCode: null,
        referralCode: '5z4un',
        createdAt: '2021-06-23T03:15:16.206Z',
        updatedAt: '2021-06-23T03:15:16.206Z',
        __v: 0,
        user: {
          id: '5a75dbe6-5b90-42c5-af44-302d5423bba8',
          username: '601666146701',
          fullName: 'Auto withVoucher QGIII',
          email: 'utowithVoucherQGIII@mail.com',
          emailVerified: false,
          createdAt: 1624418114953,
          enabled: true,
          profile: {
            internal: false,
            emailVerified: false,
            tags: [],
            userId: '5a75dbe6-5b90-42c5-af44-302d5423bba8',
            createdAt: '2021-06-23T03:15:14.953Z',
            email: 'utowithVoucherQGIII@mail.com',
            fullName: 'Auto withVoucher QGIII',
            language: 'en',
            phone: '601666146701',
            updatedAt: '2021-06-23T03:15:15.034Z',
            registrationCompleted: true,
            id: '60d2a742e1788f00111bdc93',
          },
        },
      },
      title: 'PFC ',
      campaign: '60ab19a99fe2920010a685a9',
      campaignGoalId: '60ab19a99fe2920010a685a8',
      __v: 0,
    },
    {
      _id: '60d2a64637ac760012b0dc6f',
      createdBy: {type: 'goals', name: 'registration'},
      groupGoal: null,
      multiReward: false,
      isActive: true,
      isSequenceGoal: false,
      actions: [],
      status: 'active',
      description: null,
      criteria: [
        {
          transactionTypes: null,
          target: 150,
          current: 0,
          operator: 'gte',
          _id: '60ac9b5bccfc650010ef6303',
          progress: 0,
          type: 'fuel_total',
          description: 'PETRONAS Primax 97 with Pro-race monthly usage/spend',
          dependency: {
            stations: null,
            singleTransaction: null,
            fuelType: ['fuel_primax_97'],
          },
        },
      ],
      consequence: [
        {
          index: 0,
          type: 'none',
          campaignId: null,
          value: null,
          from: null,
          expiry: null,
        },
      ],
      campaignCategory: 'achievement',
      index: 0,
      updatedAt: '2021-06-23T03:11:02.076Z',
      createdAt: '2021-06-23T03:11:02.076Z',
      campaignIterationId: '60d2a64637ac760012b0dc70',
      member: {
        _id: '60d2a64537ac760012b0dc18',
        codesHistory: [],
        recovered: false,
        referralStat: {
          registered: 0,
          purchased: 0,
          _id: '60d2a64537ac760012b0dc17',
        },
        userId: '01a0ec50-72b6-46e8-9898-6ece1a2f43e7',
        referrerCode: null,
        referralCode: 'g7a88',
        createdAt: '2021-06-23T03:11:01.339Z',
        updatedAt: '2021-06-23T03:11:01.339Z',
        __v: 0,
        user: {
          id: '01a0ec50-72b6-46e8-9898-6ece1a2f43e7',
          username: '601666094574',
          fullName: 'Auto KinSBOQL WVQVE',
          email: 'utoKinSBOQLWVQVE@mail.com',
          emailVerified: false,
          createdAt: 1624417861092,
          enabled: true,
          profile: {
            internal: false,
            emailVerified: false,
            tags: [],
            userId: '01a0ec50-72b6-46e8-9898-6ece1a2f43e7',
            createdAt: '2021-06-23T03:11:01.092Z',
            email: 'utoKinSBOQLWVQVE@mail.com',
            fullName: 'Auto KinSBOQL WVQVE',
            language: 'en',
            phone: '601666094574',
            referrerCode: '',
            updatedAt: '2021-06-23T03:11:01.156Z',
            registrationCompleted: true,
            id: '60d2a645e1788f00111bdc8d',
          },
        },
      },
      title: 'PFC ',
      campaign: '60ab19a99fe2920010a685a9',
      campaignGoalId: '60ab19a99fe2920010a685a8',
      __v: 0,
    },
  ],
  50,
  (data, index) => ({_id: `${data._id}-${index}`}),
);

const leaderBoard = createMockData(
  [
    {
      id: '5cfe3ecb879c0400122f485f',
      userId: '8ed5f6cc-684d-4682-a4c2-3758658a2aaa',
      referrerCode: null,
      tier: 'basic',
      referralCode: 'wb2q',
      updatedBy: 'system',
      createdBy: 'system',
      createdAt: '2019-06-10T11:28:11.994Z',
      updatedAt: '2020-03-26T17:19:22.510Z',
      referralStat: {
        registered: 707,
        purchased: 475,
      },
      user: null,
    },
    {
      id: '5d2ec779b925fd0010171cb7',
      userId: 'c1f21983-1a23-4820-b850-2ba5b3f42a65',
      referrerCode: null,
      tier: 'basic',
      referralCode: 'jv01',
      updatedBy: 'system',
      createdBy: 'system',
      createdAt: '2019-07-17T07:00:09.104Z',
      updatedAt: '2020-12-09T10:23:48.734Z',
      referralStat: {
        registered: 12,
        purchased: 10,
      },
      user: {
        id: 'c1f21983-1a23-4820-b850-2ba5b3f42a65',
        username: '601666000012',
        fullName: 'szdfg',
        email: 'wee@ff.cc',
        emailVerified: false,
        createdAt: 1563346808167,
        enabled: true,
        profile: {
          internal: false,
          emailVerified: false,
          tags: [],
          email: 'wee@ff.cc',
          createdAt: '2019-07-17T07:00:08.167Z',
          phone: '601666000012',
          fullName: 'szdfg',
          language: 'en',
          userId: 'c1f21983-1a23-4820-b850-2ba5b3f42a65',
          updatedAt: '2020-12-23T13:24:51.372Z',
          dateOfBirth: '2020-02-02T00:00:00.000Z',
          gender: 'female',
          identityNumber: '200202284726',
          identityType: 'ic_number',
          id: '5e8db8bb903941b890929d5b',
        },
      },
    },
    {
      id: '5f3346cb5cf4b9001043f70d',
      codesHistory: [],
      recovered: false,
      referralStat: {
        registered: 4,
        purchased: 4,
        _id: '5f3346cb5cf4b9001043f70c',
      },
      userId: '22e6ac55-390e-4d9d-8501-253c517fbddd',
      referrerCode: 'am2v4',
      referrerId: '5f17f1ff84df3000107c9ad5',
      referrerType: 'member',
      referralCode: 'ec6kx',
      createdAt: '2020-08-12T01:32:59.021Z',
      updatedAt: '2021-02-05T08:39:36.503Z',
      user: {
        id: '22e6ac55-390e-4d9d-8501-253c517fbddd',
        username: '60166630030',
        fullName: 'VETHIRTY',
        email: 'veth@setel.com',
        emailVerified: false,
        createdAt: 1597195978881,
        enabled: true,
        profile: {
          internal: false,
          emailVerified: false,
          tags: [],
          userId: '22e6ac55-390e-4d9d-8501-253c517fbddd',
          createdAt: '2020-08-12T01:32:58.881Z',
          email: 'veth@setel.com',
          fullName: 'VETHIRTY',
          language: 'en',
          phone: '60166630030',
          referrerCode: 'am2v4',
          updatedAt: '2021-02-15T08:17:01.665Z',
          registrationCompleted: true,
          dateOfBirth: '1978-08-12T00:00:00.000Z',
          gender: 'female',
          identityNumber: '780812164848',
          identityType: 'ic_number',
          id: '5f3346ca8f0ec600107f6c65',
        },
      },
    },
  ],
  27,
);

const MOCK_GOALS = {
  items: [
    {
      id: '6093be1d43fefd00102b82b8',
      createdBy: '',
      groupGoal: null,
      multiReward: false,
      isActive: false,
      isSequenceGoal: false,
      actions: [
        {
          _id: '60ab1dae688e43ed5ce57662',
          relatedDocumentId: '6b3e1f02-8135-4672-a2ec-ee8fc499c70c',
          type: 'friend',
          __v: 0,
          amount: 1,
          createdAt: '2021-05-24T03:29:50.662Z',
          isFailed: false,
          updatedAt: '2021-05-24T03:29:50.662Z',
          userId: '48824b7a-3fd2-4a31-8d4a-2ef9a5fe8ff7',
        },
      ],
      status: 'completed',
      description:
        'Refer 1 friend and get RM5 worth of Setel balance when they purchase RM30 worth of fuel',
      criteria: [
        {
          transactionTypes: [],
          target: 1,
          current: 1,
          operator: 'equal',
          _id: '6066e1b8d5c22900110acba0',
          progress: 1,
          type: 'friend',
          description: 'refer 1st',
          dependency: {
            friendThreshold: 30,
          },
          index: 0,
          id: '',
          goalId: '6093be1d43fefd00102b82b8',
        },
      ],
      consequence: [
        {
          index: 0,
          type: 'cashback',
          campaignId: null,
          value: 5,
          from: null,
          expiry: {
            type: null,
            value: 1581086907000,
          },
        },
      ],
      campaignCategory: 'achievement',
      index: 0,
      updatedAt: '2021-05-24T03:29:50.704Z',
      createdAt: '2021-05-06T09:59:57.046Z',
      campaignIterationId: '6093be1d43fefd00102b82bb',
      member: '6093be1c43fefd00102b82a2',
      title: 'Refer a Friend - 1st Referral',
      campaign: {
        _id: '5ce576a0f3b1f300124622cd',
        isActive: true,
        name: 'Refer A Friend',
        endDate: '+275760-09-13T00:00:00.000Z',
      },
      campaignGoalId: '5cf27cbc84e726000fa73e9b',
      rewards: [
        {
          isGranted: true,
          grantFailureReason: null,
          grantAttempts: 1,
          lastAttemptedToGrantAt: '2021-05-24T03:29:50.801Z',
          expiryDate: null,
          id: '60ab1dae028dda00104b264b',
          title: 'Refer a Friend - 1st Referral',
          member: '6093be1c43fefd00102b82a2',
          type: 'cashback',
          amount: 5,
          goal: '6093be1d43fefd00102b82b8',
          createdAt: '2021-05-24T03:29:50.687Z',
          updatedAt: '2021-05-24T03:29:50.802Z',
        },
      ],
      registrationDayRemaining: '',
      itemType: '',
      campaignId: '',
      memberId: '6093be1c43fefd00102b82a2',
      ruleId: '5cf27cbc84e726000fa73e9b',
      memberType: '',
      updatedBy: '',
    },
    {
      id: '6093be1d43fefd00102b82b9',
      createdBy: '',
      groupGoal: null,
      multiReward: false,
      isActive: false,
      isSequenceGoal: false,
      actions: [
        {
          _id: '60ab1dae688e43ed5ce57662',
          relatedDocumentId: '6b3e1f02-8135-4672-a2ec-ee8fc499c70c',
          type: 'friend',
          __v: 0,
          amount: 1,
          createdAt: '2021-05-24T03:29:50.662Z',
          isFailed: false,
          updatedAt: '2021-05-24T03:29:50.662Z',
          userId: '48824b7a-3fd2-4a31-8d4a-2ef9a5fe8ff7',
        },
      ],
      status: 'active',
      description:
        'Refer your 2nd friend and get RM5 worth of Setel balance when they purchase RM30 worth of fuel',
      criteria: [
        {
          transactionTypes: [],
          target: 2,
          current: 1,
          operator: 'equal',
          _id: '6066e1b8d5c22900110acba2',
          progress: 1,
          type: 'friend',
          description: 'Refer 2nd',
          dependency: {
            friendThreshold: 30,
          },
          index: 0,
          id: '',
          goalId: '6093be1d43fefd00102b82b9',
        },
      ],
      consequence: [
        {
          index: 0,
          type: 'cashback',
          campaignId: null,
          value: 5,
          from: null,
          expiry: null,
        },
      ],
      campaignCategory: 'achievement',
      index: 1,
      updatedAt: '2021-05-24T03:29:50.671Z',
      createdAt: '2021-05-06T09:59:57.046Z',
      campaignIterationId: '6093be1d43fefd00102b82bb',
      member: '6093be1c43fefd00102b82a2',
      title: 'Refer a Friend - 2nd Referral',
      campaign: {
        _id: '5ce576a0f3b1f300124622cd',
        isActive: true,
        name: 'Refer A Friend',
        endDate: '+275760-09-13T00:00:00.000Z',
      },
      campaignGoalId: '5cf27cbc84e726000fa73e9c',
      rewards: [],
      registrationDayRemaining: '',
      itemType: '',
      campaignId: '',
      memberId: '6093be1c43fefd00102b82a2',
      ruleId: '5cf27cbc84e726000fa73e9c',
      memberType: '',
      updatedBy: '',
    },
    {
      id: '6093be1d43fefd00102b82ba',
      createdBy: '',
      groupGoal: false,
      multiReward: false,
      isActive: false,
      isSequenceGoal: false,
      actions: [
        {
          _id: '60ab1dae688e43ed5ce57662',
          relatedDocumentId: '6b3e1f02-8135-4672-a2ec-ee8fc499c70c',
          type: 'friend',
          __v: 0,
          amount: 1,
          createdAt: '2021-05-24T03:29:50.662Z',
          isFailed: false,
          updatedAt: '2021-05-24T03:29:50.662Z',
          userId: '48824b7a-3fd2-4a31-8d4a-2ef9a5fe8ff7',
        },
      ],
      status: 'active',
      description:
        'Refer your 3rd friend and get RM5 worth of Setel balance when they purchase RM30 worth of fuel',
      criteria: [
        {
          transactionTypes: [],
          target: 3,
          current: 1,
          operator: 'equal',
          _id: '6066e1b8d5c22900110acba4',
          progress: 1,
          type: 'friend',
          description: 'Refer 3th',
          dependency: {
            friendThreshold: 30,
          },
          index: 0,
          id: '',
          goalId: '6093be1d43fefd00102b82ba',
        },
      ],
      consequence: [
        {
          index: 0,
          type: 'cashback',
          campaignId: null,
          value: 5,
          from: null,
          expiry: null,
        },
      ],
      campaignCategory: 'achievement',
      index: 2,
      updatedAt: '2021-05-24T03:29:50.671Z',
      createdAt: '2021-05-06T09:59:57.046Z',
      campaignIterationId: '6093be1d43fefd00102b82bb',
      member: '6093be1c43fefd00102b82a2',
      title: 'Refer a Friend - 3rd Referral',
      campaign: {
        _id: '5ce576a0f3b1f300124622cd',
        isActive: true,
        name: 'Refer A Friend',
        endDate: '+275760-09-13T00:00:00.000Z',
      },
      campaignGoalId: '5cf27cbc84e726000fa73e9d',
      rewards: [],
      registrationDayRemaining: '',
      itemType: '',
      campaignId: '',
      memberId: '6093be1c43fefd00102b82a2',
      ruleId: '5cf27cbc84e726000fa73e9d',
      memberType: '',
      updatedBy: '',
    },
    {
      id: '6093be1d43fefd00102b836d',
      createdBy: '',
      groupGoal: null,
      multiReward: false,
      isActive: true,
      isSequenceGoal: true,
      actions: [],
      status: 'active',
      description: null,
      criteria: [
        {
          descriptionLocalized: {
            en: 'Fuel up a minimum of RM40 of PETRONAS Primax 97 with Pro-Race, 3 times in the same month to earn a badge. Each badge counts as a contest entry',
            ms: 'Fuel up a minimum of RM40 of PETRONAS Primax 97 with Pro-Race, 3 times in the same month to earn a badge. Each badge counts as a contest entry - ms',
            ta: 'Fuel up a minimum of RM40 of PETRONAS Primax 97 with Pro-Race, 3 times in the same month to earn a badge. Each badge counts as a contest entry - ta',
          },
          transactionTypes: null,
          target: 40,
          current: 0,
          operator: 'gte',
          _id: '6066c562e0ec2f0010e45a4c',
          progress: 0,
          type: 'fuel_total',
          description:
            'Fuel up a minimum of RM40 of PETRONAS Primax 97 with Pro-Race, 3 times in the same month to earn a badge. Each badge counts as a contest entry',
          dependency: {
            stations: null,
            singleTransaction: true,
            fuelType: ['fuel_primax_97'],
          },
          index: 0,
          id: '',
          goalId: '6093be1d43fefd00102b836d',
        },
      ],
      consequence: [
        {
          index: 0,
          type: 'none',
          campaignId: null,
          value: null,
          from: null,
          expiry: null,
        },
      ],
      campaignCategory: 'achievement',
      index: 0,
      updatedAt: '2021-05-17T05:03:34.982Z',
      createdAt: '2021-05-06T09:59:57.197Z',
      campaignIterationId: '6093be1d43fefd00102b8370',
      member: '6093be1c43fefd00102b82a2',
      endDate: '2021-05-31T15:59:00.000Z',
      title: '1st Fuel Up',
      campaign: {
        _id: '5fcee937a022d50010d4e193',
        isActive: true,
        endDate: '2022-01-31T02:46:43.000Z',
        name: 'PETRONAS Primax 97 Contest (Bonus)',
      },
      campaignGoalId: '5fcee937a022d50010d4e192',
      rewards: [],
      registrationDayRemaining: '7 day(s) remaining',
      itemType: '',
      campaignId: '',
      memberId: '6093be1c43fefd00102b82a2',
      ruleId: '5fcee937a022d50010d4e192',
      memberType: '',
      updatedBy: '',
    },
  ],
  headers: {
    'x-page': 1,
    'x-total-count': 64,
    'x-pages-count': 4,
    'x-per-page': 20,
    'x-next-page': 2,
  },
};

const MOCK_GOAL = {
  _id: '6093be1d43fefd00102b82b8',
  createdBy: {
    type: 'goals',
    name: 'registration',
  },
  groupGoal: null,
  multiReward: false,
  isActive: false,
  isSequenceGoal: false,
  actions: [
    {
      _id: '60ab1dae688e43ed5ce57662',
      relatedDocumentId: '6b3e1f02-8135-4672-a2ec-ee8fc499c70c',
      type: 'friend',
      __v: 0,
      amount: 1,
      createdAt: '2021-05-24T03:29:50.662Z',
      isFailed: false,
      updatedAt: '2021-05-24T03:29:50.662Z',
      userId: '48824b7a-3fd2-4a31-8d4a-2ef9a5fe8ff7',
    },
  ],
  status: 'completed',
  description:
    'Refer 1 friend and get RM5 worth of Setel balance when they purchase RM30 worth of fuel',
  criteria: [
    {
      transactionTypes: [],
      target: 1,
      current: 1,
      operator: 'equal',
      _id: '6066e1b8d5c22900110acba0',
      progress: 1,
      type: 'friend',
      description: 'refer 1st',
      dependency: {
        friendThreshold: 30,
      },
    },
  ],
  consequence: [
    {
      index: 0,
      type: 'cashback',
      campaignId: null,
      value: 5,
      from: null,
      expiry: {
        type: null,
        value: 1581086907000,
      },
    },
  ],
  campaignCategory: 'achievement',
  index: 0,
  updatedAt: '2021-05-24T03:29:50.704Z',
  createdAt: '2021-05-06T09:59:57.046Z',
  campaignIterationId: '6093be1d43fefd00102b82bb',
  member: '6093be1c43fefd00102b82a2',
  title: 'Refer a Friend - 1st Referral',
  campaign: '5ce576a0f3b1f300124622cd',
  campaignGoalId: '5cf27cbc84e726000fa73e9b',
  __v: 0,
  rewards: [
    {
      _id: '60ab1dae028dda00104b264b',
      isGranted: true,
      grantFailureReason: null,
      grantAttempts: 1,
      lastAttemptedToGrantAt: '2021-05-24T03:29:50.801Z',
      expiryDate: null,
      title: 'Refer a Friend - 1st Referral',
      member: '6093be1c43fefd00102b82a2',
      type: 'cashback',
      amount: 5,
      goal: '6093be1d43fefd00102b82b8',
      createdAt: '2021-05-24T03:29:50.687Z',
      updatedAt: '2021-05-24T03:29:50.802Z',
      __v: 0,
    },
  ],
};

const failedStats = [
  {service: 'apiRewards', data: {total: 306, success: 306, failed: 0, successRate: 100}},
  {service: 'apiPayments', data: {success: 129, total: 130, failed: 1, successRate: 99}},
  {service: 'apiOrders', data: {success: 35, total: 35, failed: 0, successRate: 100}},
  {service: 'apiExternalOrders', data: {success: 0, total: 0, failed: 0, successRate: 0}},
  {service: 'apiStoreOrders', data: {success: 79, total: 79, failed: 0, successRate: 100}},
];

const failedApiPayments = [
  {
    _id: '60dc62de30d95a0011e9368c',
    userId: '4a34ebe6-c096-4d15-acb2-bc6df1e9b859',
    relatedDocumentId: '4a34ebe6-c096-4d15-acb2-bc6df1e9b859',
    amount: 0,
    type: 'createWallet',
    createdAt: '2021-06-30T12:26:06.061Z',
    ackUrl: 'api-payments/api/payments/admin/rewards/failed-actions/60dc62de30d95a0011e9368c',
    __v: 0,
    sentAt: '2021-06-30T12:26:06.105Z',
  },
];

const MOCK_USER_REFERRALS = {
  items: [
    {
      id: '6f817dc6-81da-4a72-b17e-f8ccb68181f0',
      phone: '601666543213',
      email: 'jshdjr@rkdor.kfok',
      name: 'Epwin Test',
      fuelPurchased: false,
      createdAt: '2020-03-23T02:43:25.502Z',
    },
    {
      id: 'a57d8438-d335-4123-ba16-9d29b8fef3ae',
      phone: '601666543216',
      email: 'jskd@eooej.ddr',
      name: 'Epwin Test',
      fuelPurchased: false,
      createdAt: '2020-03-23T03:28:00.670Z',
    },
    {
      id: 'cd3da534-9963-43f0-97bb-4c786669a5e1',
      phone: '601666543210',
      email: 'keke@ejekk.ekdbsh',
      name: 'Epwin Test',
      fuelPurchased: false,
      createdAt: '2020-03-23T04:29:07.671Z',
    },
  ],
  headers: {
    'x-page': 1,
    'x-total-count': 3,
    'x-pages-count': 1,
    'x-per-page': 20,
    'x-next-page': 1,
  },
};
const MOCK_USER_REFERRER = {
  id: 'e443c9c1-5f18-47a8-b672-3f9eb968d572',
  phone: '601666543202',
  email: 'jrffu@fkk.kfkr',
  name: 'Epwin B',
  referralCode: 'kwvpk',
  createdAt: '2020-03-23T09:31:30.098Z',
};

const baseUrl = `${environment.rewardsApiBaseUrl}/api/rewards`;

export const handlers = [
  rest.get(`${baseUrl}/actions/failed-stat`, createFixResponseHandler(failedStats)),
  rest.get(`${baseUrl}/actions/apiRewards/failed`, createFixResponseHandler([])),
  rest.get(`${baseUrl}/actions/apiPayments/failed`, createFixResponseHandler(failedApiPayments)),
  rest.post(`${baseUrl}/actions/re-trigger-failed`, (_, res, ctx) => {
    return res(
      ctx.json({
        apiRewards: {count: 2},
        apiPayments: {count: 392},
        apiOrders: {count: 102},
        apiLoyalty: {
          error: {
            response: {
              statusCode: 501,
              error: 'Not Implemented',
              message: "Service apiLoyalty hasn't implement reward-client yet",
            },
            status: 501,
            message: {
              statusCode: 501,
              error: 'Not Implemented',
              message: "Service apiLoyalty hasn't implement reward-client yet",
            },
          },
        },
        apiExternalOrders: {count: 0},
        apiStoreOrders: {count: 0},
      }),
      ctx.status(201),
    );
  }),

  rest.get(`${baseUrl}/campaigns/enum-types`, createFixResponseHandler(campaignEnum)),
  rest.get(
    `${baseUrl}/campaigns`,
    createPaginationHandler(CAMPAIGNS, {
      bodyMapper: ({data, total}) => ({
        total,
        data,
      }),
    }),
  ),
  rest.get(
    `${baseUrl}/campaigns/:id/members`,
    createPaginationHandler(CAMPAIGN_CUSTOMERS, {
      bodyMapper: ({data, total}) => ({
        total,
        data,
      }),
    }),
  ),
  rest.get(`${baseUrl}/campaigns/:id`, createDetailHandler(CAMPAIGNS_FOR_DETAIL, 'id')),
  rest.post(`${baseUrl}/campaigns`, (req, res, ctx) => {
    const now = new Date();
    const result = {
      id: now.getTime().toString(),
      _id: now.getTime().toString(),
      createdAt: now.toISOString(),
      updatedAt: now.toISOString(),
      ...(req.body as Record<string, any>),
    };

    CAMPAIGNS.unshift(result as any);
    return res(ctx.json(result), ctx.status(201));
  }),
  rest.put(`${baseUrl}/campaigns/:id`, (req, res, ctx) => {
    const currentRecord = CAMPAIGNS_FOR_DETAIL.find(({_id}) => _id === req.params.id);

    currentRecord.updatedAt = new Date().toISOString();

    Object.keys(req.body).forEach((key) => {
      currentRecord[key] = req.body[key];
    });

    return res(ctx.json(currentRecord));
  }),
  rest.get(
    `${baseUrl}/admin/leaderboard`,
    createPaginationHandler(
      (req) => {
        const tags = req.url.searchParams.get('tags');
        const referralCode = req.url.searchParams.get('referralCode');
        if (referralCode) {
          return leaderBoard.filter((member) => referralCode === member.referralCode);
        }
        if (tags) {
          return [];
        }
        return leaderBoard;
      },
      {
        bodyMapper: (info) => ({
          data: info.data,
          total: info.total,
        }),
      },
    ),
  ),
  rest.get(`${baseUrl}/admin/member/:id`, (req, res, ctx) => {
    const currentMember = {
      codesHistory: [],
      recovered: false,
      referralStat: {
        registered: 0,
        purchased: 0,
        _id: '5da6e2d82882d90012b10fea',
      },
      id: '5da6e2d82882d90012b10feb',
      userId: req.params.id,
      referrerCode: null,
      referralCode: '4n6yn',
      createdAt: '2019-10-16T09:28:56.993Z',
      updatedAt: '2019-10-16T09:28:56.993Z',
    };
    return res(ctx.json(currentMember));
  }),
  rest.get(`${baseUrl}/admin/goals`, (_, res, ctx) => {
    return res(ctx.json(MOCK_GOALS));
  }),
  rest.get(`${baseUrl}/admin/users/:id/referrer`, (_, res, ctx) =>
    res(ctx.json(MOCK_USER_REFERRER)),
  ),
  rest.get(`${baseUrl}/admin/users/:id/referrals`, (_, res, ctx) =>
    res(ctx.json(MOCK_USER_REFERRALS)),
  ),
  rest.get(`${baseUrl}/admin/goals/:id`, (req, res, ctx) => {
    const goalDetails = {...MOCK_GOAL, _id: req.params.id};
    return res(ctx.json(goalDetails));
  }),
];
