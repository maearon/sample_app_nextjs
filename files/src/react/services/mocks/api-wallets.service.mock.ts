import {rest} from 'msw';
import {environment} from 'src/environments/environment';
import {
  createDetailHandler,
  createMockData,
  createPaginationHandler,
} from 'src/react/lib/mock-helper';
import {CreateAdjustmentTransactionParams} from 'src/shared/interfaces/wallet.interface';

const transactions = createMockData(
  [
    {
      id: '602a4f7edf7a30001896c79b',
      transactionUid: 'e511b07c-5417-42a0-8342-794c1ad19ee0',
      walletId: '5e6854b973f8e70026f2ba90',
      fullName: 'sfsofi',
      email: 'setete@setel.my',
      userId: '7ef317dc-3633-46f3-9b7b-6d12134eeffd',
      type: 'TOPUP',
      subType: 'TOPUP_CREDIT_CARD',
      status: 'SUCCEEDED',
      amount: 10,
      currency: 'MYR',
      referenceId: '602a4f7eff126d001714f23e',
      tokenId: 'mockTokenId1612857666063',
      paymentGatewayVendor: 'IPAY88',
      paymentGatewayTransactionId: 'T1613385598741',
      errorDescription: null,
      transactionDate: '2021-02-15T10:39:58.657Z',
      attributes: {
        ipAddress: '110.159.75.192',
        longitude: '101.805716',
        latitude: '3.098318',
        email: 'setete@setel.my',
      },
      creditCardInfo: {
        cardBrand: 'VISA',
        cardCategory: '',
        paymentType: 'L_DC',
        firstSixDigits: 472312,
        lastFourDigits: 206,
        issuingBank: 'Yuu Bank',
      },
      onlineBankInfo: {issuingBank: 'Yuu Bank', acquiringBank: '', bankMid: '__mockBankMID__'},
      relatedTransactions: [],
      isRefundProcessing: false,
    },
    {
      id: '602a4f6fe4092d00173760ec',
      transactionUid: '63cd45ce-4db3-452e-bea0-22591df9ba70',
      walletId: '5e6854b973f8e70026f2ba90',
      fullName: 'sfsofi',
      email: 'setete@setel.my',
      userId: '7ef317dc-3633-46f3-9b7b-6d12134eeffd',
      type: 'TOPUP',
      subType: 'TOPUP_CREDIT_CARD',
      status: 'SUCCEEDED',
      amount: 10,
      currency: 'MYR',
      referenceId: '602a4f6fff126d001714f23c',
      tokenId: 'mockTokenId1612857666063',
      paymentGatewayVendor: 'IPAY88',
      paymentGatewayTransactionId: 'T1613385583841',
      errorDescription: null,
      transactionDate: '2021-02-15T10:39:43.743Z',
      attributes: {
        ipAddress: '110.159.75.192',
        longitude: '101.805709',
        latitude: '3.098316',
        email: 'setete@setel.my',
      },
      creditCardInfo: {
        cardBrand: 'VISA',
        cardCategory: '',
        paymentType: 'L_DC',
        firstSixDigits: 472312,
        lastFourDigits: 206,
        issuingBank: 'Yuu Bank',
      },
      onlineBankInfo: {issuingBank: 'Yuu Bank', acquiringBank: '', bankMid: '__mockBankMID__'},
      relatedTransactions: [],
      isRefundProcessing: false,
    },
    {
      id: '602a4f63df7a30001896c796',
      transactionUid: '420eaa3c-ab23-4af1-9527-eaff840d6b75',
      walletId: '5e6854b973f8e70026f2ba90',
      fullName: 'sfsofi',
      email: 'setete@setel.my',
      userId: '7ef317dc-3633-46f3-9b7b-6d12134eeffd',
      type: 'TOPUP',
      subType: 'TOPUP_CREDIT_CARD',
      status: 'SUCCEEDED',
      amount: 10,
      currency: 'MYR',
      referenceId: '602a4f63ff126d001714f23a',
      tokenId: 'mockTokenId1612857666063',
      paymentGatewayVendor: 'IPAY88',
      paymentGatewayTransactionId: 'T1613385571536',
      errorDescription: null,
      transactionDate: '2021-02-15T10:39:31.421Z',
      attributes: {
        ipAddress: '110.159.75.192',
        longitude: '101.805726',
        latitude: '3.098289',
        email: 'setete@setel.my',
      },
      creditCardInfo: {
        cardBrand: 'VISA',
        cardCategory: '',
        paymentType: 'L_DC',
        firstSixDigits: 472312,
        lastFourDigits: 206,
        issuingBank: 'Yuu Bank',
      },
      onlineBankInfo: {issuingBank: 'Yuu Bank', acquiringBank: '', bankMid: '__mockBankMID__'},
      relatedTransactions: [],
      isRefundProcessing: false,
    },
    {
      id: '602a4f2adf7a30001896c792',
      transactionUid: 'b33cd9ce-f629-46fa-8809-8e41dcbd259e',
      walletId: '5e6854b973f8e70026f2ba90',
      fullName: 'sfsofi',
      email: 'setete@setel.my',
      userId: '7ef317dc-3633-46f3-9b7b-6d12134eeffd',
      type: 'TOPUP',
      subType: 'TOPUP_CREDIT_CARD',
      status: 'SUCCEEDED',
      amount: 10,
      currency: 'MYR',
      referenceId: '602a4f29ff126d001714f238',
      tokenId: 'mockTokenId1612857666063',
      paymentGatewayVendor: 'IPAY88',
      paymentGatewayTransactionId: 'T1613385514142',
      errorDescription: null,
      transactionDate: '2021-02-15T10:38:34.033Z',
      attributes: {
        ipAddress: '110.159.75.192',
        longitude: '101.805717',
        latitude: '3.098274',
        email: 'setete@setel.my',
      },
      creditCardInfo: {
        cardBrand: 'VISA',
        cardCategory: '',
        paymentType: 'L_DC',
        firstSixDigits: 472312,
        lastFourDigits: 206,
        issuingBank: 'Yuu Bank',
      },
      onlineBankInfo: {issuingBank: 'Yuu Bank', acquiringBank: '', bankMid: '__mockBankMID__'},
      relatedTransactions: [],
      isRefundProcessing: false,
    },
    {
      id: '602a4ef2e4092d00173760e7',
      transactionUid: '4d70f54f-4c7a-4477-b384-2e532607f8be',
      walletId: '5e6854b973f8e70026f2ba90',
      fullName: 'sfsofi',
      email: 'setete@setel.my',
      userId: '7ef317dc-3633-46f3-9b7b-6d12134eeffd',
      type: 'TOPUP',
      subType: 'TOPUP_CREDIT_CARD',
      status: 'SUCCEEDED',
      amount: 10,
      currency: 'MYR',
      referenceId: '602a4ef2ff126d001714f236',
      tokenId: 'mockTokenId1612857666063',
      paymentGatewayVendor: 'IPAY88',
      paymentGatewayTransactionId: 'T1613385458597',
      errorDescription: null,
      transactionDate: '2021-02-15T10:37:38.468Z',
      attributes: {
        ipAddress: '110.159.75.192',
        longitude: '101.805733',
        latitude: '3.098263',
        email: 'setete@setel.my',
      },
      creditCardInfo: {
        cardBrand: 'VISA',
        cardCategory: '',
        paymentType: 'L_DC',
        firstSixDigits: 472312,
        lastFourDigits: 206,
        issuingBank: 'Yuu Bank',
      },
      onlineBankInfo: {issuingBank: 'Yuu Bank', acquiringBank: '', bankMid: '__mockBankMID__'},
      relatedTransactions: [],
      isRefundProcessing: false,
    },
    {
      id: '602a4eb7df7a30001896c78d',
      transactionUid: '6eb40202-06d1-4957-8690-488833617de7',
      walletId: '5e6854b973f8e70026f2ba90',
      fullName: 'sfsofi',
      email: 'setete@setel.my',
      userId: '7ef317dc-3633-46f3-9b7b-6d12134eeffd',
      type: 'TOPUP',
      subType: 'TOPUP_CREDIT_CARD',
      status: 'SUCCEEDED',
      amount: 10,
      currency: 'MYR',
      referenceId: '602a4eb7ff126d001714f234',
      tokenId: 'mockTokenId1612857666063',
      paymentGatewayVendor: 'IPAY88',
      paymentGatewayTransactionId: 'T1613385399227',
      errorDescription: null,
      transactionDate: '2021-02-15T10:36:39.118Z',
      attributes: {
        ipAddress: '110.159.75.192',
        longitude: '101.805713',
        latitude: '3.098251',
        email: 'setete@setel.my',
      },
      creditCardInfo: {
        cardBrand: 'VISA',
        cardCategory: '',
        paymentType: 'L_DC',
        firstSixDigits: 472312,
        lastFourDigits: 206,
        issuingBank: 'Yuu Bank',
      },
      onlineBankInfo: {issuingBank: 'Yuu Bank', acquiringBank: '', bankMid: '__mockBankMID__'},
      relatedTransactions: [],
      isRefundProcessing: false,
    },
    {
      id: '602a4dd0df7a30001896c788',
      transactionUid: '6a7235ac-2b68-4cd1-a8b1-6ef50e0a632e',
      walletId: '5e6854b973f8e70026f2ba90',
      fullName: 'sfsofi',
      email: 'setete@setel.my',
      userId: '7ef317dc-3633-46f3-9b7b-6d12134eeffd',
      type: 'TOPUP',
      subType: 'TOPUP_CREDIT_CARD',
      status: 'SUCCEEDED',
      amount: 10,
      currency: 'MYR',
      referenceId: '602a4dd0ff126d001714f232',
      tokenId: 'mockTokenId1612857666063',
      paymentGatewayVendor: 'IPAY88',
      paymentGatewayTransactionId: 'T1613385168817',
      errorDescription: null,
      transactionDate: '2021-02-15T10:32:48.402Z',
      attributes: {
        ipAddress: '110.159.75.192',
        longitude: '101.805753',
        latitude: '3.098284',
        email: 'setete@setel.my',
      },
      creditCardInfo: {
        cardBrand: 'VISA',
        cardCategory: '',
        paymentType: 'L_DC',
        firstSixDigits: 472312,
        lastFourDigits: 206,
        issuingBank: 'Yuu Bank',
      },
      onlineBankInfo: {issuingBank: 'Yuu Bank', acquiringBank: '', bankMid: '__mockBankMID__'},
      relatedTransactions: [],
      isRefundProcessing: false,
    },
    {
      id: '602a19930530a4001743c85e',
      transactionUid: '08a899ba-367a-4d70-a6a6-e339ab9b3382',
      walletId: '5f85210b8ba777001070ed15',
      fullName: 'Ssbb',
      email: 'ssbb@envsetel.com',
      userId: 'f481e0b7-c1f6-46fc-865e-db5bc7407374',
      type: 'TOPUP',
      subType: 'TOPUP_CREDIT_CARD',
      status: 'SUCCEEDED',
      amount: 10,
      currency: 'MYR',
      referenceId: '602a19935ecd750017145905',
      tokenId: 'jNzI2zwgjLea3996',
      paymentGatewayVendor: 'IPAY88',
      paymentGatewayTransactionId: 'T1613371796156',
      errorDescription: null,
      transactionDate: '2021-02-15T06:49:55.997Z',
      attributes: {
        ipAddress: '183.171.133.32',
        longitude: '101.654714',
        latitude: '3.138846',
        email: 'ssbb@envsetel.com',
      },
      creditCardInfo: {
        cardBrand: 'MASTERCARD',
        cardCategory: 'PREPAID RELOADABLE',
        paymentType: 'L_DC',
        firstSixDigits: 559998,
        lastFourDigits: 3996,
        issuingBank: 'BIG MALAYSIA SDN BHD',
      },
      onlineBankInfo: {issuingBank: 'Yuu Bank', acquiringBank: '', bankMid: '__mockBankMID__'},
      relatedTransactions: [],
      isRefundProcessing: false,
    },
    {
      id: '602a0774de1e84001712b5e7',
      transactionUid: '61709f8b-da70-4885-bb36-7eb2ac825c44',
      walletId: '5e6854b973f8e70026f2ba90',
      fullName: 'sfsofi',
      email: 'setete@setel.my',
      userId: '7ef317dc-3633-46f3-9b7b-6d12134eeffd',
      type: 'TOPUP',
      subType: 'TOPUP_CREDIT_CARD',
      status: 'SUCCEEDED',
      amount: 10,
      currency: 'MYR',
      referenceId: '602a07745ecd7500171458e7',
      tokenId: 'mockTokenId1612857666063',
      paymentGatewayVendor: 'IPAY88',
      paymentGatewayTransactionId: 'T1613367156431',
      errorDescription: null,
      transactionDate: '2021-02-15T05:32:36.317Z',
      attributes: {
        ipAddress: '13.250.134.29',
        longitude: '101.805819',
        latitude: '3.098415',
        email: 'setete@setel.my',
      },
      creditCardInfo: {
        cardBrand: 'VISA',
        cardCategory: '',
        paymentType: 'L_DC',
        firstSixDigits: 472312,
        lastFourDigits: 206,
        issuingBank: 'Yuu Bank',
      },
      onlineBankInfo: {issuingBank: 'Yuu Bank', acquiringBank: '', bankMid: '__mockBankMID__'},
      relatedTransactions: [],
      isRefundProcessing: false,
    },
    {
      id: '602a0729de1e84001712b5e3',
      transactionUid: '36223160-aa47-4610-a10a-19b138a024ae',
      walletId: '5e6854b973f8e70026f2ba90',
      fullName: 'sfsofi',
      email: 'setete@setel.my',
      userId: '7ef317dc-3633-46f3-9b7b-6d12134eeffd',
      type: 'TOPUP',
      subType: 'TOPUP_CREDIT_CARD',
      status: 'SUCCEEDED',
      amount: 10,
      currency: 'MYR',
      referenceId: '602a07285ecd7500171458e5',
      tokenId: 'mockTokenId1612857666063',
      paymentGatewayVendor: 'IPAY88',
      paymentGatewayTransactionId: 'T1613367081159',
      errorDescription: null,
      transactionDate: '2021-02-15T05:31:21.016Z',
      attributes: {
        ipAddress: '13.250.134.29',
        longitude: '101.805776',
        latitude: '3.098282',
        email: 'setete@setel.my',
      },
      creditCardInfo: {
        cardBrand: 'VISA',
        cardCategory: '',
        paymentType: 'L_DC',
        firstSixDigits: 472312,
        lastFourDigits: 206,
        issuingBank: 'Yuu Bank',
      },
      onlineBankInfo: {issuingBank: 'Yuu Bank', acquiringBank: '', bankMid: '__mockBankMID__'},
      relatedTransactions: [],
      isRefundProcessing: false,
    },
    {
      id: '602b209930334d0017813928',
      transactionUid: '9dcb4f0b-565c-42a5-8524-d4d24b76b203',
      walletId: '5e6854b973f8e70026f2ba90',
      fullName: 'sfsofi',
      email: 'setete@setel.my',
      userId: '7ef317dc-3633-46f3-9b7b-6d12134eeffd',
      type: 'TOPUP_REFUND',
      subType: 'TOPUP_REFUND_CREDIT_CARD',
      status: 'PROCESSING',
      amount: 10,
      currency: 'MYR',
      refundedTransactionUid: '36223160-aa47-4610-a10a-19b138a024ae',
      referenceId: '602a07285ecd7500171458e5(R)',
      tokenId: 'mockTokenId1612857666063',
      paymentGatewayVendor: 'IPAY88',
      errorDescription: null,
      transactionDate: '2021-02-16T01:32:09.966Z',
      attributes: {
        email: 'setete@setel.my',
      },
      creditCardInfo: {
        cardBrand: 'VISA',
        cardCategory: '',
        paymentType: 'L_DC',
        firstSixDigits: 472312,
        lastFourDigits: 206,
        issuingBank: 'Yuu Bank',
      },
      relatedTransactions: [
        {
          transactionId: '602a0729de1e84001712b5e3',
          transactionUid: '36223160-aa47-4610-a10a-19b138a024ae',
          transactionType: 'TOPUP',
          transactionSubType: 'TOPUP_CREDIT_CARD',
          referenceId: '602a07285ecd7500171458e5',
        },
      ],
    },
    {
      id: '601a6a78d1520100178966af',
      transactionUid: '5398d5ad-2eef-4b6b-bbdc-957892840c0b',
      walletId: '5fc0a1d37d984100100aedd9',
      fullName: 'nfzh',
      email: '60166694816@email.com',
      userId: 'f80f892c-d1fa-4d36-8079-86ccb4faf9d8',
      type: 'TOPUP_REFUND',
      subType: 'TOPUP_REFUND_DIGITAL_WALLET',
      status: 'SUCCEEDED',
      amount: 15,
      currency: 'MYR',
      refundedTransactionUid: '977d72ff-be5e-4eff-aa1c-898bcf00ab8b',
      referenceId: '601a5bf255c37400174b4584(R)',
      paymentGatewayVendor: 'BOOST',
      paymentGatewayTransactionId: '2102036232952013',
      errorDescription: '',
      transactionDate: '2021-02-03T09:18:48.822Z',
      attributes: {
        email: '60166694816@email.com',
      },
      relatedTransactions: [
        {
          transactionId: '601a5bf3d1520100178966a7',
          transactionUid: '977d72ff-be5e-4eff-aa1c-898bcf00ab8b',
          transactionType: 'TOPUP',
          transactionSubType: 'TOPUP_DIGITAL_WALLET',
          referenceId: '601a5bf255c37400174b4584',
        },
      ],
      paymentMethod: 'wallet',
    },
    {
      id: '601cb3b6bf0d6b0017b80eba',
      transactionUid: 'daab87c8-6450-45b5-aec0-8dc8a3f144e9',
      walletId: '5f0c1d4ac2ae420010dc3160',
      fullName: 'anhlkh',
      email: 'anhbc@envsetel.com',
      userId: '1f689f1e-13cc-490e-aa85-d4efbe7c6a45',
      type: 'ADJUSTMENT',
      subType: 'ADJUSTMENT_OTHER',
      status: 'SUCCEEDED',
      amount: -148.58,
      currency: 'MYR',
      transactionDate: '2021-02-05T02:55:50.874Z',
      attributes: {
        comment: '',
        email: 'anhbc@envsetel.com',
      },
      relatedTransactions: [],
    },
    {
      id: '601cb3a4bf0d6b0017b80eb8',
      transactionUid: '4c737f9c-c11c-47e8-84c7-43b9edee8ba9',
      walletId: '5f0c1d4ac2ae420010dc3160',
      fullName: 'anhlkh',
      email: 'anhbc@envsetel.com',
      userId: '1f689f1e-13cc-490e-aa85-d4efbe7c6a45',
      type: 'ADJUSTMENT',
      subType: 'ADJUSTMENT_OTHER',
      status: 'SUCCEEDED',
      amount: 97.79,
      currency: 'MYR',
      transactionDate: '2021-02-05T02:55:32.873Z',
      attributes: {
        comment: '',
        email: 'anhbc@envsetel.com',
      },
      relatedTransactions: [],
    },
  ],
  200,
  (seed, index) => ({
    ...seed,
    id: `${seed.id}${index}`,
    transactionUid: `${seed.transactionUid}${index}`,
    referenceId: seed.referenceId ? `${seed.referenceId}${index}` : (undefined as any),
  }),
);

const BASE_URL = `${environment.walletApiBaseUrl}/api/wallets`;

export const handlers = [
  rest.get(
    `${BASE_URL}/transactions`,
    createPaginationHandler((req) => {
      const type = req.url.searchParams.get('type');

      if (type) {
        return transactions.filter((trx) => trx.type === type);
      }

      return transactions;
    }),
  ),
  rest.get(
    `${BASE_URL}/transactions/:id`,
    createDetailHandler(transactions, 'id', {propToMatch: ['transactionUid']}),
  ),
  rest.post(`${BASE_URL}/admin/topups/:referenceId/refund`, (req, res, ctx) => {
    const trx = transactions.find(
      (tx) => tx.referenceId === req.params.referenceId && tx.type === 'TOPUP',
    );

    Object.assign(trx, {isRefundProcessing: true});

    const refundTrx = {
      ...trx,
      type: 'TOPUP_REFUND',
      subType: 'TOPUP_REFUND_CREDIT_CARD',
      status: 'PROCESSING',
    };

    transactions.unshift(refundTrx);

    return res(ctx.json(trx));
  }),
  rest.post(`${BASE_URL}/transactions/adjustments`, (req, res, ctx) => {
    const body = req.body as CreateAdjustmentTransactionParams;
    const MOCK_CREATE_ADJUSTMENT = {
      id: '612f37604df13f0012d2d4e7',
      transactionUid: '49773d0c-0bee-4d6d-94ce-6fcd51c81879',
      walletId: '60ab0f4046957f00170d424e',
      fullName: 'some name',
      email: 'someemail@setel.my',
      userId: body.customerId,
      type: 'ADJUSTMENT',
      subType: 'ADJUSTMENT_OTHER',
      status: 'SUCCEEDED',
      amount: body.amount,
      currency: body.currency,
      transactionDate: new Date().toISOString(),
      attributes: {
        '0': ['comment', body.comment],
        email: 'someemail@setel.my',
      },
      relatedTransactions: [],
    };
    return res(ctx.json(MOCK_CREATE_ADJUSTMENT));
  }),
];
