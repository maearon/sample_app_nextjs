import {rest} from 'msw';
import {environment} from 'src/environments/environment';
import {
  createMockData,
  createPaginationHandler,
  createDetailHandler,
} from 'src/react/lib/mock-helper';

const mockCompanyTypes = [
  {
    products: {
      retail: false,
      fulfillment: false,
      fuelling: true,
      catalogue: true,
      pointOfSale: true,
      eCommerce: true,
      inventory: true,
      shipping: true,
      timesheet: true,
      loyalty: true,
      deals: true,
      gifts: true,
      vehicles: true,
      payments: true,
      houseAccounts: true,
      billing: true,
      billsReloads: true,
      cardIssuing: true,
      pricing: true,
      paymentController: true,
      developer: true,
      dropIn: false,
      mini: false,
    },
    id: '60f5317b63f5cc2c565bc0f0',
    name: 'Smartpay',
    code: 'smartpay',
    enterpriseId: 'setel',
    createdAt: '2021-07-19T08:02:03.925Z',
    updatedAt: '2021-07-19T10:16:58.333Z',
  },
];

const mockCompanies = createMockData(
  [
    {
      _id: '602e220c1dcf1500118245fe',
      name: 'Thomas.company.dev',
      products: {
        retail: false,
        fuelling: false,
        fulfillment: false,
        catalogue: true,
        pointOfSale: true,
        eCommerce: true,
        inventory: false,
        shipping: false,
        timesheet: false,
        loyalty: false,
        deals: false,
        gifts: false,
        vehicles: false,
        payments: false,
        billing: false,
        billsReloads: false,
        pricing: false,
        cardIssuing: false,
        dropIn: false,
        mini: false,
      },
      enterpriseId: 'setel',
      typeId: mockCompanyTypes[0].id,
      code: 'smp1',
      companyType: mockCompanyTypes[0],
      createdAt: '2021-02-18T08:15:08.492Z',
    },
    {
      _id: '6018bb5ac1217f0018df6fb1',
      name: 'Marry_company',
      products: {
        retail: true,
        fuelling: true,
        fulfillment: true,
        catalogue: false,
        pointOfSale: false,
        eCommerce: true,
        inventory: true,
        shipping: true,
        timesheet: true,
        loyalty: true,
        deals: true,
        gifts: true,
        vehicles: true,
        payments: true,
        billing: true,
        billsReloads: true,
        pricing: true,
        cardIssuing: true,
        dropIn: true,
        mini: true,
        paymentController: true,
        developer: true,
        riskControls: true,
      },
      enterpriseId: 'setel',
      createdAt: '2021-02-02T02:39:22.547Z',
    },
    {
      _id: '601232606f829400126f6c00',
      name: 'Dior',
      products: {
        retail: false,
        fuelling: false,
        fulfillment: false,
        catalogue: false,
        pointOfSale: false,
        eCommerce: false,
        inventory: false,
        shipping: false,
        timesheet: false,
        loyalty: false,
        deals: false,
        gifts: false,
        vehicles: false,
        payments: false,
        billing: false,
        billsReloads: false,
        pricing: false,
        cardIssuing: false,
        dropIn: false,
        mini: false,
        paymentController: false,
        riskControls: false,
        developer: false,
      },
      enterpriseId: 'setel',
      typeId: mockCompanyTypes[0].id,
      code: 'smp2',
      companyType: mockCompanyTypes[0],
      createdAt: '2021-01-28T03:41:20.532Z',
    },
    {
      _id: '6007cd674ccd3600186f0ab5',
      name: 'devpayed-company-1',
      products: {
        retail: true,
        fuelling: true,
        fulfillment: true,
        catalogue: true,
        pointOfSale: true,
        eCommerce: true,
        inventory: true,
        shipping: true,
        timesheet: true,
        loyalty: true,
        deals: true,
        gifts: true,
        vehicles: true,
        payments: true,
        billing: true,
        billsReloads: true,
        pricing: true,
        cardIssuing: true,
        subsidy: true,
        dropIn: true,
        mini: true,
        paymentController: true,
        developer: true,
      },
      enterpriseId: 'setel',
      typeId: mockCompanyTypes[0].id,
      code: 'smp3',
      companyType: mockCompanyTypes[0],
      createdAt: '2021-01-20T06:27:51.206Z',
    },
    {
      _id: '6006b1d5a4f2d30011e9d666',
      name: 'gin2225',
      products: {
        retail: false,
        fuelling: false,
        fulfillment: false,
        catalogue: false,
        pointOfSale: false,
        eCommerce: false,
        inventory: false,
        shipping: false,
        timesheet: false,
        loyalty: false,
        deals: false,
        gifts: false,
        vehicles: false,
        payments: false,
        billing: false,
        billsReloads: false,
        pricing: false,
        cardIssuing: false,
        subsidy: false,
        dropIn: false,
        mini: false,
      },
      enterpriseId: 'setel',
      createdAt: '2021-01-19T10:17:57.996Z',
    },
    {
      _id: '60068385c505670011ff89f4',
      name: 'Sasha Testing',
      products: {
        retail: false,
        fuelling: false,
        fulfillment: false,
        catalogue: false,
        pointOfSale: false,
        eCommerce: false,
        inventory: false,
        shipping: false,
        timesheet: false,
        loyalty: false,
        deals: false,
        gifts: false,
        vehicles: false,
        payments: false,
        billing: false,
        billsReloads: false,
        pricing: false,
        cardIssuing: false,
        subsidy: false,
        dropIn: false,
        mini: false,
      },
      enterpriseId: 'setel',
      createdAt: '2021-01-19T07:00:21.596Z',
    },
    {
      _id: '5fffbd20b9956ea6ca1c0980',
      name: 'dnos-company+3',
      products: {
        retail: false,
        fuelling: false,
        fulfillment: false,
        catalogue: false,
        pointOfSale: false,
        eCommerce: false,
        inventory: false,
        shipping: false,
        timesheet: false,
        loyalty: false,
        deals: false,
        gifts: false,
        vehicles: false,
        payments: false,
        billing: false,
        billsReloads: false,
        pricing: false,
        cardIssuing: false,
        subsidy: false,
        dropIn: false,
        mini: false,
      },
      enterpriseId: 'setel',
      createdAt: '2021-01-14T03:40:16.650Z',
    },
    {
      _id: '5fffbcd2b9956ea6ca1c097f',
      name: 'dnos-company+2',
      products: {
        retail: true,
        fulfillment: true,
        fuelling: true,
        catalogue: true,
        pointOfSale: true,
        eCommerce: true,
        inventory: true,
        shipping: true,
        timesheet: true,
        loyalty: true,
        deals: true,
        gifts: true,
        vehicles: true,
        payments: true,
        billing: true,
        billsReloads: true,
        pricing: true,
        cardIssuing: true,
        subsidy: true,
        paymentController: true,
        developer: true,
        dropIn: false,
        mini: true,
      },
      enterpriseId: 'setel',
      createdAt: '2021-01-14T03:38:58.525Z',
    },
    {
      _id: '5fffb803612f600018f77df9',
      name: 'dnos-company+2',
      products: {
        retail: false,
        fuelling: false,
        fulfillment: false,
        catalogue: false,
        pointOfSale: false,
        eCommerce: false,
        inventory: false,
        shipping: false,
        timesheet: false,
        loyalty: false,
        deals: false,
        gifts: false,
        vehicles: false,
        payments: false,
        billing: false,
        billsReloads: false,
        pricing: false,
        cardIssuing: false,
        subsidy: false,
        dropIn: true,
      },
      enterpriseId: 'setel',
      createdAt: '2021-01-14T03:18:27.917Z',
    },
    {
      _id: '5ffe9646e3fa3000182fe9ba',
      name: 'DEMO - COMPANY',
      products: {
        retail: true,
        fuelling: false,
        fulfillment: true,
        catalogue: true,
        pointOfSale: true,
        eCommerce: true,
        inventory: false,
        shipping: true,
        timesheet: false,
        loyalty: false,
        deals: false,
        gifts: false,
        vehicles: false,
        payments: false,
        billing: false,
        billsReloads: false,
        pricing: false,
        cardIssuing: false,
        subsidy: true,
        paymentController: true,
      },
      enterpriseId: 'setel',
      createdAt: '2021-01-13T06:42:14.208Z',
    },
    {
      _id: '5ffe8e40e3fa3000182fe9b9',
      name: 'Test demo company',
      products: {
        retail: true,
        fuelling: false,
        fulfillment: false,
        catalogue: true,
        pointOfSale: true,
        eCommerce: true,
        inventory: false,
        shipping: true,
        timesheet: false,
        loyalty: false,
        deals: false,
        gifts: false,
        vehicles: false,
        payments: false,
        billing: false,
        billsReloads: false,
        pricing: false,
        cardIssuing: false,
        subsidy: false,
      },
      enterpriseId: 'setel',
      createdAt: '2021-01-13T06:08:00.299Z',
    },
    {
      _id: '5ffe57b0e3fa3000182fe9b8',
      name: 'dnos-company-1',
      products: {
        retail: true,
        fuelling: true,
        fulfillment: true,
        catalogue: true,
        pointOfSale: false,
        eCommerce: false,
        inventory: false,
        shipping: false,
        timesheet: false,
        loyalty: false,
        deals: false,
        gifts: false,
        vehicles: false,
        payments: false,
        billing: false,
        billsReloads: false,
        pricing: false,
        cardIssuing: false,
        subsidy: false,
        mini: false,
        dropIn: true,
        developer: false,
      },
      enterpriseId: 'setel',
      createdAt: '2021-01-13T02:15:12.864Z',
    },
    {
      _id: '5ffd6ecba90dfd0019df3cea',
      name: 'Tina Test',
      products: {
        retail: false,
        fuelling: false,
        fulfillment: false,
        catalogue: true,
        pointOfSale: true,
        eCommerce: true,
        inventory: false,
        shipping: false,
        timesheet: false,
        loyalty: false,
        deals: false,
        gifts: false,
        vehicles: false,
        payments: false,
        billing: false,
        billsReloads: false,
        pricing: false,
        cardIssuing: false,
        subsidy: false,
      },
      enterpriseId: 'setel',
      createdAt: '2021-01-12T09:41:31.774Z',
    },
    {
      _id: '5ffc25b87e0d5a00189489e0',
      name: 'payed_test_company_1',
      products: {
        retail: true,
        fuelling: true,
        fulfillment: true,
        catalogue: true,
        pointOfSale: true,
        eCommerce: true,
        inventory: true,
        shipping: true,
        timesheet: true,
        loyalty: true,
        deals: true,
        gifts: true,
        vehicles: true,
        payments: true,
        billing: true,
        billsReloads: true,
        pricing: true,
        cardIssuing: true,
        subsidy: true,
        paymentController: true,
        developer: true,
        dropIn: true,
        mini: true,
      },
      enterpriseId: 'setel',
      createdAt: '2021-01-11T10:17:28.640Z',
    },
    {
      _id: '5ffbcaf58d662d00181998ae',
      name: 'Testing',
      products: {
        retail: true,
        fuelling: false,
        fulfillment: false,
        catalogue: true,
        pointOfSale: true,
        eCommerce: true,
        inventory: false,
        shipping: true,
        timesheet: false,
        loyalty: false,
        deals: false,
        gifts: false,
        vehicles: false,
        payments: false,
        billing: false,
        billsReloads: false,
        pricing: false,
        cardIssuing: false,
        subsidy: false,
      },
      enterpriseId: 'setel',
      createdAt: '2021-01-11T03:50:13.690Z',
    },
    {
      _id: '5ff6d1bfcee91f001149f0fe',
      name: 'Ashley - Company 1',
      products: {
        retail: false,
        fuelling: true,
        fulfillment: true,
        catalogue: true,
        pointOfSale: false,
        eCommerce: false,
        inventory: false,
        shipping: false,
        timesheet: false,
        loyalty: false,
        deals: false,
        gifts: false,
        vehicles: false,
        payments: true,
        billing: false,
        billsReloads: false,
        pricing: false,
        cardIssuing: false,
        subsidy: false,
      },
      enterpriseId: 'setel',
      createdAt: '2021-01-07T09:17:51.841Z',
    },
    {
      _id: '5ff6899acee91f001149f0fd',
      name: 'thomas-ecommerce',
      products: {
        retail: false,
        fuelling: false,
        fulfillment: false,
        catalogue: true,
        pointOfSale: false,
        eCommerce: true,
        inventory: false,
        shipping: false,
        timesheet: false,
        loyalty: false,
        deals: false,
        gifts: false,
        vehicles: false,
        payments: false,
        billing: false,
        billsReloads: false,
        pricing: false,
        cardIssuing: false,
        subsidy: false,
      },
      enterpriseId: 'setel',
      createdAt: '2021-01-07T04:10:02.790Z',
    },
    {
      _id: '5ff67befcee91f001149f0fc',
      name: 'Thomas-C9',
      products: {
        retail: false,
        fuelling: false,
        fulfillment: false,
        catalogue: true,
        pointOfSale: true,
        eCommerce: true,
        inventory: true,
        shipping: false,
        timesheet: false,
        loyalty: false,
        deals: false,
        gifts: false,
        vehicles: false,
        payments: false,
        billing: false,
        billsReloads: false,
        pricing: false,
        cardIssuing: false,
        subsidy: false,
      },
      enterpriseId: 'setel',
      createdAt: '2021-01-07T03:11:43.735Z',
    },
    {
      _id: '5ff672cfcee91f001149f0fb',
      name: 'Andrew-C dev',
      products: {
        retail: false,
        fuelling: false,
        fulfillment: false,
        catalogue: true,
        pointOfSale: true,
        eCommerce: true,
        inventory: true,
        shipping: false,
        timesheet: false,
        loyalty: false,
        deals: false,
        gifts: false,
        vehicles: false,
        payments: false,
        billing: false,
        billsReloads: false,
        pricing: false,
        cardIssuing: false,
        subsidy: false,
      },
      enterpriseId: 'setel',
      createdAt: '2021-01-07T02:32:47.884Z',
    },
    {
      _id: '5ff53cd54c02300011d262d7',
      name: 'Toby-C demo',
      products: {
        retail: false,
        fuelling: false,
        fulfillment: false,
        catalogue: true,
        pointOfSale: true,
        eCommerce: true,
        inventory: true,
        shipping: false,
        timesheet: false,
        loyalty: false,
        deals: false,
        gifts: false,
        vehicles: false,
        payments: false,
        billing: false,
        billsReloads: false,
        pricing: false,
        cardIssuing: false,
        subsidy: false,
      },
      enterpriseId: 'setel',
      createdAt: '2021-01-06T04:30:13.941Z',
    },
  ],
  200,
);

const baseUrl = `${environment.companiesApiBaseUrl}/api/companies`;

export const handlers = [
  rest.get(
    `${baseUrl}/admin/companies`,
    createPaginationHandler((req) => {
      let res = [...mockCompanies];
      const keyWord = req.url.searchParams.get('keyWord');
      const companyType = req.url.searchParams.get('companyType');

      if (keyWord) {
        res = res.filter((comp) => comp.name.toUpperCase().includes(keyWord.toUpperCase()));
      }

      if (companyType) {
        res = res.filter((comp) => comp.companyType && comp.companyType.code === companyType);
      }

      return res;
    }),
  ),
  rest.get(`${baseUrl}/admin/companies/:id`, createDetailHandler(mockCompanies, 'id')),
  rest.put(`${baseUrl}/admin/companies/:id`, (req, res, ctx) => {
    const matchedRecord = mockCompanies.find((com) => com._id === req.params.id);

    if (!matchedRecord) {
      return res(ctx.status(404));
    }

    Object.assign(matchedRecord, req.body);

    return res(ctx.json(matchedRecord));
  }),
  rest.get(
    `${baseUrl}/admin/companyTypes`,
    createPaginationHandler((req) => {
      const searchValue = req.url.searchParams.get('searchValue');

      if (searchValue) {
        return mockCompanyTypes.filter(
          (type) =>
            type.name.toLowerCase().includes(searchValue.toLowerCase()) ||
            type.code.toLowerCase().includes(searchValue.toLowerCase()),
        );
      }

      return mockCompanyTypes;
    }),
  ),
];
